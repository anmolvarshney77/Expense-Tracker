# Render Blueprint: backend (Django + PostgreSQL) + frontend (Next.js) on free tier
# Deploy: push to GitHub, connect repo at https://dashboard.render.com → New → Blueprint
# After deploy: set CORS_ALLOWED_ORIGINS on backend to your frontend URL (e.g. https://expense-tracker-frontend.onrender.com)
#               set NEXT_PUBLIC_API_BASE_URL on frontend to your backend URL (e.g. https://expense-tracker-backend.onrender.com)

databases:
  - name: expense-tracker-db
    databaseName: expenses_db
    plan: free

services:
  - type: web
    name: expense-tracker-backend
    runtime: python
    plan: free
    rootDir: backend
    buildCommand: "pip install -r requirements.txt && python manage.py collectstatic --noinput"
    startCommand: "for i in 1 2 3 4 5 6 7 8 9 10; do python manage.py migrate --noinput && break; echo 'Waiting for database...'; sleep 5; done && exec python -m gunicorn config.wsgi:application --bind 0.0.0.0:$PORT"
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: expense-tracker-db
          property: connectionString
      - key: SECRET_KEY
        generateValue: true
      - key: DEBUG
        value: "False"
      - key: ALLOWED_HOSTS
        value: ".onrender.com"
      - key: CORS_ALLOWED_ORIGINS
        sync: false

  - type: web
    name: expense-tracker-frontend
    runtime: node
    plan: free
    rootDir: frontend
    buildCommand: "npm install && npm run build"
    startCommand: "npm run start"
    envVars:
      - key: NODE_VERSION
        value: "20"
      - key: NEXT_PUBLIC_API_BASE_URL
        sync: false
